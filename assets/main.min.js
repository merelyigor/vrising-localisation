(()=>{"use strict";!function(){let e={},t=[],n=null;const o=40,r=document.getElementById("downloadLink"),l=localStorage.getItem("mainLocalizationArr");if(l&&l.length>100){r.style.display="flex";const e=localStorage.getItem("saveTime");e&&(document.getElementById("save-info-text").style.display="flex",s(e))}function s(e){const t=document.getElementById("saveTime");document.getElementById("save-info-text").style.display="flex",t&&(t.textContent=`Файл вже було згенеровано вами раніше, та збережено: ${new Date(e).toLocaleString()}`)}function c(e){const t=document.querySelector(".text-processing");t&&(t.innerHTML=e)}function i(e,t){const n=document.getElementById("progressBar"),o=document.getElementById("progressText"),r=Math.round(e/t*100);o.style.display="flex",n&&(n.style.width=`${r}%`),o&&(o.textContent=`${r}%`)}async function a(e,t={},n=300,o=1e3){let r=document.querySelector(".text-processing");for(let l=0;l<n;l++)try{const n=await fetch(e,t);if(!n.ok)throw new Error("Fetch error");return n}catch(e){if(console.error(`Fetch error on attempt ${l+1}: ${e.message}`),!(l<n-1))throw console.error("Error: Сервер не може надати відповідь!"),console.error("Error: Перевищено максимальну кількість спроб на відповіді від серверу!"),c(`Сервер повернув занадто багато помилкових відповідей \n                    а саме більше ніж ${n}.\n                    <br> Перевищено максимальну кількість спроб на відповіді від серверу!\n                    <br> Спробуйте перезавантажити сторінку та повторити генерацію заново.\n                    <span class="error">!!!</span>`),r.style.color="#ff0000",r.style.border="5px solid #ff0000",r.classList.add("shake-element"),e;await new Promise((e=>setTimeout(e,o)))}}function d(){!function(){const e=document.querySelector(".spinner"),t=document.querySelector(".container-spinner"),n=document.querySelector(".container-spinner-text");e&&(e.style.display="flex",t.style.display="flex",n.style.display="flex")}(),i(0,10),document.getElementById("downloadLink").style.display="none",document.getElementById("save-info-text").style.display="none",a("/?start-generation=1").then((e=>e.json())).then((l=>{let a=0;const d=l.length;let f=0;!function g(){if(a<l.length){let t=l[a];m(t.id,t.name).then((n=>{e[t.name]=n,a++,f++,i(f,d),g()})).catch((e=>{console.error("Error fetching strings:",e)}))}else(async function(e,t){const n=[],r=Object.values(e).reduce(((e,t)=>e+t.length),0);let l=0;for(let s in e)if(e.hasOwnProperty(s)&&s.endsWith(".csv")){let a=e[s];c(`Обробляємо та зберігаємо усі ID строк для файлу ${s}`);for(let e of a)n.push(u(s,e.fileId,e.stringId,e.stringIdentifier,t).then((()=>{l++,i(l,r)}))),n.length>=o&&(await Promise.all(n),n.length=0)}n.length>0&&await Promise.all(n);!function(){const e=document.querySelector(".spinner"),t=document.querySelector(".container-spinner");e&&(e.style.display="none",t.style.display="none")}()})(e,t).then((()=>{!function(e){i(100,100);const t={codes:[],nodes:e},o=JSON.stringify(t,null,2);localStorage.setItem("mainLocalizationArr",o);const l=(new Date).toISOString();localStorage.setItem("saveTime",l);const c=new Blob([o],{type:"application/json"});n=URL.createObjectURL(c);const a=document.createElement("a");if(a.href=n,a.download="Ukraine.json",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(n),r){let e=localStorage.getItem("saveTime");e&&(document.getElementById("save-info-text").style.display="flex",s(e)),r.style.display="inline"}}(t)})).catch((e=>{console.error("Error processing all file strings:",e)}))}()})).catch((e=>{console.error("Error fetching files:",e)}))}function m(e,t,n=0,o=[]){return c(`Запитую усі ID рядків для файлу ${t}`),new Promise(((r,l)=>{a(`/?getAllStrings=all&fileId=${e}&offset=${n}`).then((e=>e.json())).then((s=>{500===s.length?(n+=s.length,o=o.concat(s),m(e,t,n,o).then(r).catch(l)):(o=o.concat(s),r(o))})).catch((e=>{console.error("Error fetching strings:",e),l(e)}))}))}function u(e,t,n,o,r){return new Promise(((l,s)=>{a(`/?translate=uk&fileId=${t}&stringId=${n}&stringIdentifier=${o}`).then((e=>e.json())).then((t=>{r.push({guid:t.stringIdentifier,text:t.text}),c(`Обробка перекладу для рядка ${t.stringIdentifier} <br>\n                                                  у файлі ${e} <br>\n                                                  фраза: ${t.text}`),l()})).catch((e=>{console.error("Error fetching translation:",e),s(e)}))}))}document.getElementById("toggleButton").addEventListener("click",(function(){const e=document.getElementById("textBlock"),t=this;e.classList.contains("expanded")?(e.classList.remove("expanded"),t.textContent="Показати все"):(e.classList.add("expanded"),t.textContent="Показати менше")})),r&&r.addEventListener("click",(function(e){e.preventDefault(),function(){let e=localStorage.getItem("mainLocalizationArr");if(e){const t=JSON.parse(e),n=JSON.stringify(t,null,2),o=new Blob([n],{type:"application/json"}),r=window.URL.createObjectURL(o),l=document.createElement("a");l.href=r,l.download="Ukraine.json",document.body.appendChild(l),l.click(),document.body.removeChild(l),setTimeout((()=>{window.URL.revokeObjectURL(r)}),1e3)}}()})),document.getElementById("generateBtn").addEventListener("click",(function(){d()}))}()})();